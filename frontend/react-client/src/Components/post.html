<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Post</title>
</head>
<body>
  <div class="container">
    <h1>Create Post</h1>
    <input type="text" id="title" placeholder="Enter post title">
    <textarea id="content" rows="5" placeholder="Enter post content"></textarea>
    <br>
    <button id="publishBtn">Publish</button>
    <button id="resetBtn">Reset</button>
    <div id="toast" class="toast"></div>

    <h2>Published Posts</h2>
    <div id="posts"></div>
  </div>

  <script>
    const publishBtn = document.getElementById("publishBtn");
    const resetBtn = document.getElementById("resetBtn");
    const postsDiv = document.getElementById("posts");
    const toast = document.getElementById("toast");

    function showToast(message) {
      toast.innerText = message;
      toast.style.display = "block";
      setTimeout(() => { toast.style.display = "none"; }, 2000);
    }

    // Render a post with comments
    function renderPost(post) {
      const postDiv = document.createElement("div");
      postDiv.classList.add("post");
      postDiv.innerHTML = `
        <h3>${post.title}</h3>
        <p>${post.content}</p>
        <div class="comment-section">
          <div class="comment-input">
            <input type="text" placeholder="Add a comment">
            <button class="add-comment">Comment</button>
          </div>
          <div class="comments"></div>
        </div>
      `;

      const commentInput = postDiv.querySelector(".comment-input input");
      const addCommentBtn = postDiv.querySelector(".add-comment");
      const commentsDiv = postDiv.querySelector(".comments");

      // Render existing comments
      post.comments.forEach(c => {
        const comment = document.createElement("div");
        comment.classList.add("comment");
        comment.innerText = c.text;
        commentsDiv.appendChild(comment);
      });

      // Add new comment
      addCommentBtn.onclick = () => {
        const text = commentInput.value.trim();
        if (!text) return;
        fetch(`/api/posts/${post.id}/comments`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        })
        .then(res => res.json())
        .then(comment => {
          const newComment = document.createElement("div");
          newComment.classList.add("comment");
          newComment.innerText = comment.text;
          commentsDiv.appendChild(newComment);
          commentInput.value = "";
          showToast("üí¨ Comment added!");
        });
      };

      postsDiv.prepend(postDiv);
    }

    // Load posts from server on page load
    function loadPosts() {
      fetch("/api/posts")
        .then(res => res.json())
        .then(posts => {
          postsDiv.innerHTML = "";
          posts.forEach(renderPost);
        });
    }

    // Publish new post
    publishBtn.onclick = () => {
      const title = document.getElementById("title").value.trim();
      const content = document.getElementById("content").value.trim();
      if (!title || !content) { showToast("‚ö†Ô∏è Please enter title and content"); return; }

      fetch("/api/posts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, content })
      })
      .then(res => res.json())
      .then(post => {
        renderPost(post);
        document.getElementById("title").value = "";
        document.getElementById("content").value = "";
        showToast("‚úÖ Post published!");
      });
    };

    // Reset input fields
    resetBtn.onclick = () => {
      document.getElementById("title").value = "";
      document.getElementById("content").value = "";
      showToast("üóëÔ∏è Cleared inputs");
    };

    loadPosts();
  </script>
</body>
</html>
